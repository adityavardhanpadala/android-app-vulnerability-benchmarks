# Summary
Apps that allow copying of *sensitive information to clipboard* may leak information.  

# Android versions affected
Tested on Android 4.4 - Android 7.1

# Description of vulnerability and corresponding exploit
Android clipboard is accessible by every app. Widgets like *EditText* by default allows users to copy the contents
present on these widgets. To *copy* the information, users can *long-click* on *EditText* and then select *copy*
from *dialog-box*. By doing so, the contents of *EditText* widget will be copied into *clipboard*. When contents of the
*clipboard* changes, apps that have registered for notifications about changes to the clipboard (via addPrimaryClipChangedListener)
will be notified and they will have access to the contents of the clipboard.

*Issue:* Apps may allow users to copy *sensitive information* to the clipboard. In such situations, malicious apps
can “steal” this sensitive information by merely accessing the clipboard.  

*Example:* This vulnerability is demonstrated by *Benign*  and *Malicious*. *Benign* app has textfields to enter username and password.
*Benign* app provides a button which allows user to copy password on clipboard and then paste it wherever they want. *Malicious* app has a listener which triggers if the *clipboard's contents* changes and tracks these changes which leads to *information exposure*.

*Note:* A *sensitive information* cannot be copied if *setCustomSelectionActionModeCallback()* return value set to false for onCreateActionMode(). We manually tested benchmark on APIs 19 to 25 and it behaves as expected. For instrumentation testing of benchmark, we created a button to copy text from *EditText* to *clipboard*, because UiAutomator is not able to detect dialog box which pops-up after long-clicking the *EditText*.  

# Steps to build the sample apps and to exploit the vulnerability

1. List targets:

    `$ android list targets`

2. List available Android Virtual Devices:

    `$ android list avd`

3. Create an emulator:

    `$ android create avd -n <name> -t <target>`

    *<target>* is obtained from the command listed in 1. *<name>* is the name you choose to give to the avd.

4. Start emulator:

    `$ emulator -avd <avd_name>`

    *<avd-name>* is obtained from the command listed in 2.

5. Build and install *Benign*:

    `$ cd Benign`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk. Build will fail without this.

    `$ ./gradlew installDebug`

6. Build and install *Malicious*:

    `$ cd Malicious`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk. Build will fail without this.

    `$ ./gradlew installDebug`

7. Launch *Malicious* in the emulator where it is installed.

8. Launch *Benign* in the emulator where it is installed.
9.  Enter username and password, and then either press *COPY-PASS* button or copy the contents of password by long clicking on password and then selecting *copy* option.
10. Bring *Malicious* to foreground.

    You will see the copied contents displayed on screen.

# Reference

[Security Smells in Android](http://scg.unibe.ch/archive/papers/Ghaf17c.pdf)
