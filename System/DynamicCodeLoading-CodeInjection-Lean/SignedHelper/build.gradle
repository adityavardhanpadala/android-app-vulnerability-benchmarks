apply plugin: 'java'

sourceCompatibility = 6
targetCompatibility = 6

def getBuildToolsVersion() {
    def ret
    new File("../../../Misc/sdkFlavors.gradle").eachLine {
        if (it ==~ /.*buildToolsVersion.*/) {
            ret = it.trim().replace('"', '').tokenize(' ')[1]
        }
    }
    return ret
}


task dexify(type:Exec, dependsOn: assemble) {
    def androidHome = System.getenv('ANDROID_HOME')
    def buildToolsVersion = getBuildToolsVersion()
    executable "$androidHome/build-tools/$buildToolsVersion/dx"
    args "--dex", "--output=build/libs/unsigned-greetings.jar", 
         "build/libs/greetingsHelper.jar"
    outputs.file "build/libs/unsigned-greetings.jar"
}

task sign(type:Exec, dependsOn: dexify) {
    executable "jarsigner"
    args "-keystore", 
         "../../../Misc/android_keys/keyOne-pass_keyOne-alias_keyOne-validity_10May2019-storepass_keyOne.jks", 
         "-signedjar", "build/libs/signed-greetings.jar",
         "-storepass", "keyOne",
         "-keypass", "keyOne",
         "build/libs/unsigned-greetings.jar", "keyOne"
    outputs.file "build/libs/signed-greetings.jar"
}
