# Summary
Apps that allow Javascript code to execute in a WebView permits JavaScript to run malicious codes.

# Android versions affected
Tested on Android 4.4 - Android 7.1

# Description of vulnerability and corresponding exploit
An Android app can display web pages by loading HTML/JavaScript files in a *WebView*. The loaded
HTML/JavaScript file runs in the context of the app i.e. it has access to the same resources and has the
same permissions the app has. An adversary could inject malicious code through javascript and get it run if javascript execution is allowed. 


*Issue:* Android provides *setJavaScriptEnabled()* API to enable/disable Javascript execution. The *setJavaScriptEnabled()* call with value true enables execution of JavaScript exists in the code. Provided the WebView allows JavaScript execution and the app fetches web content from untrustworthy sources,
an application can execute malicious JavaScript inside the WebView. 

*Example:* The vulnerability is demonstrated by *Benign*. The *MainActivity* of this app has a WebView which loads an HTML file from a server. The WebView uses *WebSetting.setJavaScriptEnable(true)* to enable JavaScript to execute. When the javascript inside the html executes, it changes the content of the html. In secure version of the app this issue is mitigated by invoking the default browser to display untrusted webpages.


# Steps to build the sample apps and to exploit the vulnerability

1. Setup a local Web Server. We have used Flask here. If you want to use Flask follow the instructions [here](https://bitbucket.org/secure-it-i/android-app-vulnerability-benchmarks/src/76cc87180f064b328c37cc57b5c743dba378a5de/Misc/LocalServer/README.md?at=master&fileviewer=file-view-default).

2. List targets:

    `$ android list targets`

3. List available Android Virtual Devices:

    `$ android list avd`

4. Create an emulator:

    `$ android create avd -n <name> -t <target>`

    *<target>* is obtained from the command listed in 1. *<name>* is the name you choose to give to the avd.

5. Start emulator:

    `$ emulator -avd <avd_name>`

    *<avd-name>* is obtained from the command listed in 3.


6. Build and install *Benign*:

    `$ cd Benign`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk.

    `$ ./gradlew installDebug`


7. Launch *Benign*.

    The WebView should display a webpage having a text "This text is set by javascript".

# References

1. [Security Smells in Android](http://scg.unibe.ch/archive/papers/Ghaf17c.pdf)
