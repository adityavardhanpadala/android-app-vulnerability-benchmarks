# Summary
Apps that do not check for the validity of a host name when communicating with a server are
vulnerable to MITM attacks.   

# Android versions affected
Tested on Android 4.2 - Android 7.1

# Description of vulnerability and corresponding exploit
Android apps can use SSL/TLS for secure communication with a web server. Such communication involves two checks:

1. Check whether the web server is signed by a Certficate Authority that is trusted by the client, in this case the app. 
2. After establishing the validity of the Certficate Authority, verify whether the certificate presented by the server is correct.  If it is not then the connection should be refused. Verification of the certificate can fail due two reasons:
    a. The certificate presented by the server does not have the correct hostname in its subject line. 
    b. The server returns an incorrect certificate to the client due to virtual hosting.

## Issue
Android allows apps to override the default *HostnameVerifier* and implement their own HostnameVerifier.
The *verify* method in *HostnameVerifier* can be used to explicitly check for a host name that the app expects
and returns a boolean. But if the method is incorrectly implemented then the app can end up connecting
to a malicious server.

## Example
An example of such a vulnerability is shown in *ExploitHostNameVerification/Benign*. The app
connects to a server over TLS that produces a certificate that is incorrect. The implements in its own
*HostnameVerifier.verify()* method and returns true all the time. This means that the app can connect to
a server with any host name. A malicious server can easily connect to the app due to this vulnerability.


# Steps to build the sample apps and re-produce the exploit

1. list targets:

    $ android list targets

2. available Android Virtual Devices:

    $ android list avd

3.  create an emulator:

    $ android create avd -n <name> -t <target>

4. start emulator:

    $ emulator -avd <avd_name>

5. build and install *Benign* app:

    $ cd Benign

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk. Build will fail without this.

    $ ./gradlew installDebug
