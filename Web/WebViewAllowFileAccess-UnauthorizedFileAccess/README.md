# Summary
Apps that allow Javascript code to execute in a WebView without verifying where the JavaScript is coming from, can expose the app's resources.

# Android versions affected
Tested on Android 4.2 - Android 7.1

# Description of vulnerability and corresponding exploit
An Android app can display web pages by loading HTML/JavaScript files in a *WebView*. The loaded
HTML/JavaScript file runs in the context of the app i.e. it has access to the same resources and has the
same permissions the app has. For example, an HTML file loaded into the app from a server will have access
to the app's internal file system because the HTML file loaded from the server runs in the context of
the app. Android provides the *WebSettings* API through which one can switch on/off the WebView's ability
to execute JavaScript or access its resources.


*Issue:* If the webcontent is loaded from an insecure source then an attacker can execute malicious
JavaScript inside the WebView. If the WebView has access to the the app's internal resources or has
permission to perform privileged operations then the malicious JavaScript inside the WebView will also
have the same ability.

*Example:* An example of such a vulnerability is shown in *WebViewAllowFileAccess-UnauthorizedFileAccess/Benign*. The
*MainActivity* of this app has a WebView which loads an HTML file from an internal file system.
The WebView uses *WebSetting.setJavaScriptEnable(true)* to enable JavaScript to execute in its context and
uses *WebSetting.setAllowFileAccessFromFileURLs(true)* to enable URLs with file scheme to access files
in the app's internal file system. Note that this is secure because the web page is loaded from a file
in the internal file-system. However, the web page includes a JavaScript source from an Http server which
gets loaded into the WebView when the file URL is loaded. The JavaScript source will execute in the same
context as that of the file URL which means that the JavaScript will execute in the context of the WebView
and because of *WebSetting.setJavaScriptEnable(true)* and *WebSetting.setAllowFileAccessFromFileURLs(true)*
it will be able to access files in the internal file system. Since, the JavaScript is being loaded from
an Http server it is not secure because a man in the middle can easily inject malicious JavaScript code
and read/write/execute files in the internal file system of the app.


# Steps to build the sample apps and re-produce the exploit

1. list targets:

    $ android list targets

2. available Android Virtual Devices:

    $ android list avd

3.  create an emulator:

    $ android create avd -n <name> -t <target>

4.  start emulator:

    $ emulator -avd <avd_name>

5. build and install *Benign*:

    $ cd Benign

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk. Build will fail without this.

    $ ./gradlew installDebug
