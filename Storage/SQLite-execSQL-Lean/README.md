# Summary
Apps that use *SQLiteDatabase.execSQL()* method to construct non-parameterized SQL queries are vulnerable to SQL injection attacks.

# Versions of Android affected
Tested on Android 4.4 - 7.1

# Description of the vulnerability and the corresponding exploit
Android allows apps to save data in a local database called SQLlite. SQL queries are used to interact with the SQLlite database. *execSQL()* method of SQLlite allows developer to execute queries such as INSERT/DELETE/UPDATE which does not return any result.

*Issue:* If the app does not parameterize the queries it uses to interact with the database then it is vulnerable to SQL injection attacks. An app can use non-parameterize string query to perform INSERT/DELETE/UPDATE operations on *SQLiteDatabase*. If an app using an input accepted from the user or any other application without sanitizing it to perform INSERT/DELETE/UPDATE then it is vulnerable to SQL-Injection attacks.

*Example:* We demonstrate this benchmark with the help of two apps *Benign* and *Malicious*. *Benign/MiddleActivity* uses a non-parameterized query to update the value of a key. *Benign/MiddleActivity* is also exported. *Malicious* uses a specially crafted query to change all the *key/value* pairs in the table. *Benign* takes input from another app which wants to update its key/value pair. *Benign* uses these inputs without sanitizing them. Malicious takes advantage of this exposition to the *Benign* app, and provides an value as an input with where clause *1=1*, which returns all the entries from the table. *SQLite* accepts this modified query as a valid query and updates all the records with the value specified by *Malicious*.  

# Steps to build the sample apps and to exploit the vulnerability

1. List targets:

    `$ android list targets`

2. List available Android Virtual Devices:

    `$ android list avd`

3. Create an emulator:

    `$ android create avd -n <name> -t <target>`

    *<target>* is obtained from the command listed in 1. *<name>* is the name you choose to give to the avd.

4. Start emulator:

    `$ emulator -avd <avd_name>`

    *<avd-name>* is obtained from the command listed in 2.

5. Build and install *Benign*:

    `$ cd Benign`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk.

    `$ ./gradlew installDebug`

6. Launch *Benign* and click *Truncate Data* and then *Insert Data* button.   

7. Build and install *Malicious*:

    `$ cd Malicious`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk.

    `$ ./gradlew installDebug`

8.  Launch *Malicious* and click on *Data Injection* button.

    It will start *Benign's Middle Activity*. You will see updated pairs of *key/value* displayed on the screen.

9. Click back button.

    You will see *Malicious* activity with textview set to *Success*.

10. Check in log for all the *key/value pairs*

    `$ adb logcat -d | grep "Malicious"`

# References

1.  [Android Official Documentation](https://developer.android.com/reference/android/database/sqlite/SQLiteDatabase.html#compileStatement(java.lang.String)

2.  [ISSTA-15](https://researcher.watson.ibm.com/researcher/files/us-otripp/issta15.pdf)
