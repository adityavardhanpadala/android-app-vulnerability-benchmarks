# Summary
A broadcast receiver registered dynamically is exported by default.

# Versions of Android affected
Android 4.2 - Android 7.1

# Description of the vulnerability and the corresponding exploit.
Broadcast Receivers can register to receive messages (intents) statically in the manifest file (as shown in ExploitBroadCastReceiver1) or they be registered dynamically inside a .java file. Dynamically registering a broadcast receiver also exports the receiver automatically.

*Issue:* Since, dynamically registering a broadcast receiver exports a broadcast receiver, it can be triggered by any app, including unintended apps, via an intent.

*Example:* This vulnerability is demonstrated by the pair of apps *DynamicalyBroadcastReceiverRegistration-UnrestrictedAccess/Benign* and *DynamicalyBroadcastReceiverRegistration-UnrestrictedAccess/Malicious*. *MainActivity.java* in DynamicallyBroadcastReceiverRegistration-UnrestrictedAccess/Benign/app/src/main/java.../MainActivity.java, has a broadcast receiver that is registered when an activity gets created and is unregistered when the activity is destroyed. When the user leaves the particular activity the broadcast receiver registered with this activity is triggered and an email is sent to the app's developers informing them that the user left the app.
Meanwhile, just because the user left the activity, the system does not destroy it and because the activity is not destroyed the broadcast receiver is still registered to receive intents. Also, since the BroadCastReceiver was registered dynamically it got exported by default. A malicious app can invoke this BroadCastReceiver and exploit it to send emails even if the malicious app is not authorized to send emails as shown in DynamicallyBroadcastReceiverRegistration-UnrestrictedAccess/Malicious/app/src/main/java/.../MalActivity.java. Sending email is not very dangerous but the broadcast receiver exposed accidentally could very well be performing a more dangerous operation.

# Steps to build the sample apps and re-produce the exploit

1. list targets:

    `$ android list targets`

2. list available Android Virtual Devices:

    `$ android list avd`

3.  create an emulator:

    `$ android create avd -n <name> -t <target>`

    *<target>* is obtained from the command listed in 1. *<name>* is the name you choose to give to the avd.

4.  start emulator:

    `$ emulator -avd <avd_name>`

    *<avd-name>* is obtained from the command listed in 2.

5.  build and install Benign:

    `$ cd Benign`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk. Build will fail without this.

    `$ ./gradlew installDebug`

6.  build and install Malicious:

    `$ cd Malicious`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk. Build will fail without this.

    `$ ./gradlew installDebug`

7.  Open *Benign* in the emulator where you installed the app.

8.  Open *Malicious* in the emulator where you installed the app.

9.  Check log:

    `$ adb logcat -d | grep "UserLeftBroadcastRecv"`

    You will see a message "An email will be sent to rookie@malicious.com with the text : I can send email without any permissions"

    This means the Benign/UserLeftBroadcastRecv was called successfully from *Malicious*.
