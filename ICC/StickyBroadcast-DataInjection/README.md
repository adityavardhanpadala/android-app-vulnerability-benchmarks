# Summary
Apps that send sticky broadcasts are vulnerable to leaking sensitive information and data injection attacks

# Versions of Android affected
Tested on Android 4.2 - Android 7.1

# Description of the vulnerability and the corresponding exploit.
Android allows apps to send broadcast messages to notify other apps of some event. A broadcast message can be of 3 kinds - *normal*, *ordered*, and *sticky*. A broadcast message is received by a component that is registered to receive the message via an intent-filter. This registration can be done statically or dynamically. If the broadcast message is *normal*, then the Android system picks a receiver at random, sends the message to that receiver and kills the broadcast message. If the broadcast message is *ordered*, the Android system sends the broadcast message to all receivers in the order of their *priority*. If the broadcast message is *sticky*, then Android system sends the broadcast receiver to all the registered receivers but does not kill the broadcast message. The broadcast message sticks around so that if some other receiver dynamically registers to receive this broadcast message in the future, it can do so easily.  

*Issue:* Since a *sticky* broadcast message sticks around in the system forever, a malicious app could retrieve it and change it. When a benign app retrieves the broadcast message,it will end up retrieving the broadcast message modified by the malicious app.

*Example:* This vulnerability is demonstrated by 3 apps *StickyBroadcast-DataInjection/Benign*, *StickyBroadcast-DataInjection/BenignPartner, and StickyBroadcast-DataInjection/Malicious*. The *MainActivity* in the *Benign* app sends a sticky broadcast message with a phone number in it. The broadcast is meant for *MyReceiver* in *BenignPartner*, which is called when the user interacts with *BenignPartner*. *MyReceiver* retrieves the phone number from the broadcast message and sends an SMS to that number. The *MalActivity* component in the *Malicious* app offers some useful functionality to the user. When the user interacts with it, it retrieves the *sticky broadcast* in the background without the user's knowledge and injects a phone number into it. It then rebroadcasts the message without the user's knowledge. When *MyReceiver* in *BenignPartner* receives this broadcast, it now sends an SMS to the phone number injected by the *Malicious* app instead of sending SMS to the phone number that was in the original *sticky* broadcast message.  

# Steps to build the sample apps and re-produce the exploit

1. list targets:

    `$ android list targets`

2. list available Android Virtual Devices:

    `$ android list avd`

3.  create an emulator:

    `$ android create avd -n <name> -t <target>`

    *<target>* is obtained from the command listed in 1. *<name>* is the name you choose to give to the avd.

4.  start emulator:

    `$ emulator -avd <avd_name>`

    *<avd-name>* is obtained from the command listed in 2.

5.  build and install Benign:

    `$ cd Benign`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk. Build will fail without this.

    `$ ./gradlew installDebug`

6.  build and install Malicious:

    `$ cd Malicious`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk. Build will fail without this.

    `$ ./gradlew installDebug`

7.  build and install BenignPartner:

    `$ cd BenignPartner`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk.

    `$ ./gradlew installDebug`

8.  Open *Benign* in the emulator where you installed the app.

9.  Open *Malicious* in the emulator where you installed the app.

10.  Open *BenignPartner* in the emulator where you installed the app.

     `You will see a message "Sent SMS to 1800-123-0000". This is the phone number injected by the malicious app.`

# References

1.  [Official Android Documentation](https://developer.android.com/reference/android/content/Context.html#sendStickyBroadcast(android.content.Intent))

2.  [Sticky Broadcast Security Vulnerability](https://www.appvigil.co/blog/2015/03/sticky-broadcast-security-vulnerabilities-in-android-apps/)

3.  [Analyzing Inter-Application Communication in Android - Erika Chin](http://delivery.acm.org/10.1145/2010000/2000018/p239-chin.pdf?ip=129.130.18.123&id=2000018&acc=ACTIVE%20SERVICE&key=B63ACEF81C6334F5%2E4E35D685407F209B%2E4D4702B0C3E38B35%2E4D4702B0C3E38B35&CFID=942603125&CFTOKEN=56076065&__acm__=1496165285_ffebacbe6ce375d4ff15ec146273cc83)
