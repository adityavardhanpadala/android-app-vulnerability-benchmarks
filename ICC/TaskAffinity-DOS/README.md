# Summary
Apps are vulnerable to phishing attacks and denial of serivce attacks if the device contains malicious apps that use taskAffinity.

# Android versions affected
Tested on Android 4.4 - Android 7.1

# Description of vulnerability and corresponding exploit
An activity A can request to start in the task other than its default task. This means that whenever an activity starts it will start in the task it has affinity for. The name of the default affinity for an application is the package name set by the <manifest> element.

*Issue:* An activity M in a malicious app can use task affinity to start in the same task as that of a launcher activity in a benign app, thereby allowing activity M to launch a Denial-Of-Service attack or a Phishing attack.

*Example:* This vulnerability is demonstrated by *Benign* and *Malicious*. The manifest.xml file has an activity called *MalActivity* which has a
*taskAffinity="cs.ksu.edu.benign"*. This means that MalActivity will always be started in the task *cs.ksu.edu.benign* which is
the same task in which all activities of the Benign app are started. Since, MalActivity now became root of the task stack to which Benign app has affinity for, starting an activity of the Benign app will
start *MalActivity*. In this case MalActivity denies the service by preventing Benign app from launching.

# Steps to build the sample apps and to exploit the vulnerability

1. List targets:

    `$ android list targets`

2. List available Android Virtual Devices:

    `$ android list avd`

3. Create an emulator:

    `$ android create avd -n <name> -t <target>`

    *<target>* is obtained from the command listed in 1. *<name>* is the name you choose to give to the avd.

4. Start emulator:

    `$ emulator -avd <avd_name>`

    *<avd-name>* is obtained from the command listed in 2.

5. Build and install *Benign*:

    `$ cd Benign`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk.

    `$ ./gradlew installDebug`

6. Build and install *Malicious*:

    `$ cd Malicious`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk.

    `$ ./gradlew installDebug`

7.  Launch *Malicious* in emulator where it is installed.

8.  Launch *Benign* in emulator where it is installed. You will always see *Mali  cious* instead of Benign.

# References

1.  [Official Android Documentation](https://developer.android.com/guide/topics/manifest/activity-element.html#aff)

2.  [Towards Discovering and Understanding Task Hijacking in Android - Chuangang Ren](https://www.usenix.org/node/190944)
