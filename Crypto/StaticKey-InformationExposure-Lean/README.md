# Summary
Apps that store the encryption key in the source code are vulnerable to leaking encrypted information.

# Versions of Android affected
Tested on Android 4.4 - Android 7.1

# Description of the vulnerability and the corresponding exploit
Android apps can use block cipher algorithms to encrypt sensitive information using the *Cipher* API.

*Issue:* The *Cipher* API expects a key. If the key being used for encryption/decryption is saved in the source code then an attacker can get access to it.

*Example:* This vulnerability is demonstrated by the pair of apps *Benign* and *Malicious*. *Benign* has a reset password feature which allows registered users to change their password. A registered user needs to provide her email id to reset her password. *Benign* takes this email id, encrypts it using *AES* in *GCM* mode and sends it as a token to the email id. The user can use this token to reset the password. Unfortunately, *Benign* saves a static/constant key in its code base. An attacked decompiles the code base to obtain the constant key. The attacker creates *Malicious* where uses the key obtained to generate a token for the email id whose password the attacker wants to change. *Malicious* can use this newly generated token to start *NewPasswordActivity* in *Benign* and reset the password of the chosen email id.


# Steps to build the sample apps and to exploit the vulnerability

1. List targets:

    `$ android list targets`

2. List available Android Virtual Devices:

    `$ android list avd`

3. Create an emulator:

    `$ android create avd -n <name> -t <target>`

    *target* is obtained from the command listed in 1. *name* is the name you choose to give to the avd.

4. Start emulator:

    `$ emulator -avd <avd_name>`

    *avd-name* is obtained from the command listed in 2.

5. Build and install Benign:

    `$ cd Benign`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk.

    `$ ./gradlew installDebug`

6. Build and install Malicious:

    `$ cd Malicious`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk.

    `$ ./gradlew installDebug`

8.  Open *Malicious* in the emulator where you installed the app.

9.  In *Malicious* click *Reset Password* button. You should be able to see the *Reset Password* for *anniemaes@gmail.com* in *Benign*.

# References

1. [An Empirical study of Crypto API misuse in Android apps](http://dl.acm.org/citation.cfm?id=2516693)

2. [Official Android Documentation](https://developer.android.com/reference/javax/crypto/Cipher.html)
