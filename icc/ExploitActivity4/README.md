# Summary
Task Affinity and Task Re-parenting allows malicious activities to carry out phishing attacks and denial of serivce attacks.

# Android versions affected
Tested on Android 4.2 - Android 7.1

# Description of vulnerability and corresponding exploit
When an activity is started, the android system looks for a task in which to launch the activity in. A task is a collection of activities. An activity can specify that it should always be
launched as the root of a task. The root of a task is what is visible to the user. 


*Issue:* Since, an activity is allowed to specify itself as the root of a task, a malicious app could tell the android system to start a malicious activity in the same task
as that of a benign app as the root of that task. Whenever, that task comes to the foreground the malicious activity will be displayed to the user. This technique could be used to show
a fake login screen to the user in order to steal her credentials or it could be used to preven the user from performing an action like unintsalling an app.

*Example:* An example of such an attack is illustrated in ExploitActivity4/Malicious. The manifest.xml file has an activity called *MalActivity* which has a 
*taskAffinity="edu.ksu.cs.santos.benign"* and has *android:allowTaskReparenting="true"*. This means that MalActivity will always be started in the task *edu.ksu.cs.santos.benign* which is
the same task in which all activities of the ExploitActivity4/Benign app are started. Since, MalActivity also has *allowTaskReparenting* set to true, starting an activity of the Benign app will
start *MalActivity*. In this case MalActivity looks exactly like the Benign app's login screen. The user will key in the credentials and leak her credentials to the malicious app. Once the
user clicks on log in, she will be taken back to the Benign app with an appropriate message and asking the user to log in. The user will never know that her credentials have been compromised.


# Steps to re-produce the exploit with Android Studio
1.    Go to open an existing project in Android Studio and browse to ExploitActivity1/Malicious
2.    If an emulator exists or a device is connected, launch Benign in it.
3.    If an emulator or device is not available then go to Run->Run App and click on "Create New Virtual Device".
4.    Follow the instructions to create an emulator and launch Benign in it.
5.    Again go to open existing project in Android Studio and browse to ExploitAndroidActivity1/Benign
6.    Launch Benign in the same emulator/device that has Malicious.
7.    Go to emulator/device.
8.    You will see MalActivity.
# Steps to re-produce the exploit automatically
Coming soon.



