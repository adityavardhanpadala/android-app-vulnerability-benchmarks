# Summary
Task Affinity and Task Re-parenting allows malicious activities to carry out phishing attacks and denial of serivce attacks.

# Android versions affected
Tested on Android 4.2 - Android 7.1

# Description of vulnerability and corresponding exploit
When an activity is started, the android system looks for a task in which to launch the activity in. A task is a collection of activities. An activity can specify that it should always be
launched as the root of a task. The root of a task is what is visible to the user.


*Issue:* Since, an activity is allowed to specify itself as the root of a task, a malicious app could tell the android system to start a malicious activity in the same task
as that of a benign app as the root of that task. Whenever, that task comes to the foreground the malicious activity will be displayed to the user. This technique could be used to show
a fake login screen to the user in order to steal her credentials or it could be used to preven the user from performing an action like unintsalling an app.

*Example:* An example of such an attack is illustrated in ExploitActivity4/Malicious. The manifest.xml file has an activity called *MalActivity* which has a
*taskAffinity="edu.ksu.cs.santos.benign"* and has *android:allowTaskReparenting="true"*. This means that MalActivity will always be started in the task *edu.ksu.cs.santos.benign* which is
the same task in which all activities of the ExploitActivity4/Benign app are started. Since, MalActivity also has *allowTaskReparenting* set to true, starting an activity of the Benign app will
start *MalActivity*. In this case MalActivity looks exactly like the Benign app's login screen. The user will key in the credentials and leak her credentials to the malicious app. Once the
user clicks on log in, she will be taken back to the Benign app with an appropriate message and asking the user to log in. The user will never know that her credentials have been compromised.

# Steps to build the sample apps and re-produce the exploit

1. list targets:

    $ android list targets

2. available Android Virtual Devices:

    $ android list avd

3.  create an emulator:

    $ android create avd -n <name> -t <target>

4.  start emulator:

    $ emulator -avd <avd_name>

5. build and install *Benign*:

    $ cd Benign

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk. Build will fail without this.

    $ ./gradlew installDebug

6.  build and install *Malicious*:

    $ cd Malicious

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk. Build will fail without this.

    $ ./gradlew installDebug

7.  Launch *Malicious* in emulator where it is installed.

8.  Launch *Benign* in emulator where it is installed. You will always see *Malicious* instead of Benign.
