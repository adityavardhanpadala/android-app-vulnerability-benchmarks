# Summary
A broadcast receiver registered to receive ordered broadcasts is susceptible to receive data from malicous broadcast receiver with higher priority.

# Versions of Android affected
Tested on Android 4.2 - Android 7.0

# Sample list of apps that exhibit the vulnerability
Yet to be explored.

# Description of the vulnerability and the corresponding exploit.
A BroadCast Receiver can register to receive *ordered* broadcasts. When an ordered broadcast is sent then all broadcast receivers registered to receive that broadcast respond to it in the *order of priority*. The receivers with higher priority respond first and forward it to receivers with lower priority. If multiple receivers have the same priority then the order is undefined i.e. any receiver with the same priority could respond first and forward it along.

*Issue:* Since, higher priority receivers respond first and forward it to lower priority receivers, a malicious receiver with high priority can intercept the message change it and forward it to lower priority receivers.

*Example:* An example of this is shown in *OrderedBroadcast-DataInjection/benign/app/src/main/AndroidManifest.xml*. This manifest file registers *FormatOutgoingCallReceiver* to receive an intent from the system whenever an outgoing call is placed. By default the priority of *FormatOutgoingCallReceiver* is set to 0 by the system. The receiver belongs to a benign app whose job is to check if an outgoing call belongs to the US and pre-pend +1 to it before placing the call. The app helps users to dial a phone number without bothering about the international code for that number.
A malicious broadcast receiver *MalOutgoingCallReceiver* in *OrderedBroadcast-DataInjection/Malicious/app/src/main/AndroidManifest.xml* also registers to receive an intent from the system when an outgoing call is placed, but with a higher priority (1 in this case). It intercepts the call and replaces the number with a number of its choice. This means that any call made from the benign app will always dial a number chosen by the malicious app. In fact even if the user dials a number from the original phone app of her device the number chosen by the malicious app will get dialled.


# Pre-requisites for build
The sample apps were tested with Android Studio 2.3. Download the most recent version
[here](https://developer.android.com/studio/index.html)

# Steps to build the sample apps and re-produce the apps in Android Studio
1.	Open Android Studio
2.	Go to Open Existing Project
3. 	Browse to ../OrderedBroadcast-DataInjection/Benign
4.	Go to Run->Run app
5.	If devices is connected or emulator is running then app is launched.
6.	If device or emulator not connected then either connect a device or choose an existing emulator or click on "Create New Android Virtual Device".
7.	If you are connected to a device then app will be launched in the device. If you launched an existing emulator then app will be launched in the emulator. If you created a new virtual device then select it and launch the app in it.
8.  Go to File->Open abd browse to ../OrderedBroadcast-DataInjection/Malicious.
9.  Go to Run->Run app and install/launch the malicious app in the same emulator/device in which the benign app was installed/launched.
10. Use the Call button in the benign app or the call app in emulator/device to call any phone number. You will see that the same number is always dialled. This is number is the same number that is hardcoded in *MalOutgoingCallReceiver*.
11. Note for devices/emulators running Android 6.0 and above you will have to manually go to settings and grant both the apps process outgoing call permission.

# Steps to build the sample apps and re-produce the apps automatically
Coming soon
