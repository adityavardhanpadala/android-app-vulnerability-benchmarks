# Summary
Malicious activities with high priorities can hijack benign activities.

# Android versions affected
Tested on Android 4.2 - Android 7.1

# Description of vulnerability and corresponding exploit
An activity in Android can be started by passing the package name and the class name to an intent or by passing a string identifier. This string identifier is not unique. It can resolve
to more than one activity. When an activity with a string identifier is started and it is the only activity with that string identifier then the activity is started. However, if the string
identifier is used for more than one activity then the user is asked to choose the activity she wants to start from a list of activities with that string identifier. Activities with higher
priority are displayed first.  


*Issue:* If a benign activity uses an *intent-filter* to specify a string identifier then a malicious activity could use the same string identifier in its *intent-filter*. The problem is
exacerbated when the malicious activity has a higher priority than the benign activity. An activity can choose a priority by specifying a positive integer in the *android:priority* field in
the manifest file. If an activity does not set the priority explicitly then the Android system assigns it a priority of 0. When a string a identifier resolves to multiple activities, a list
of activities is displayed to the user for the user to choose. If a malicious activity has a higher priority then it will appear before the benign activity making it highly likely for the 
user to choose the malicious activity over the benign activity. 

*Example:* An example of such an attack is illustrated in ExploitActivity4/Benign and ExploitActivity4/Malicious. The manifest.xml file in Benign has *ImageEditor* activity with priority
set to 5. The Malicious app has an activity MalActivity with priority 100. Both activities have the same *action* or string identifier *edu.ksu.cs.santos.benign.imageEditor*. This means
that MalActivity can be started instead of *ImageEditor*. In this case MalActivity hijacks the image sent to ImageEditor. If the image contains sensitive information then it is leaked via
MalActivity. For this to work MalActivity will have to look very similar to ImageEditor and should provide the same functionality so that the user chooses MalActivity over ImageEditor 
and does not understand that her images are being leaked.


# Steps to re-produce the exploit with Android Studio
1.    Go to open an existing project in Android Studio and browse to ExploitActivity1/Benign
2.    If an emulator exists or a device is connected, launch Benign in it.
3.    If an emulator or device is not available then go to Run->Run App and click on "Create New Virtual Device".
4.    Follow the instructions to create an emulator and launch Benign in it.
5.    Again go to open existing project in Android Studio and browse to ExploitAndroidActivity1/Malicious
6.    Launch Malicious in the same emulator/device that has Benign.
7.    Go to emulator/device.
8.    Go back to the Benign app and navigate to ImageEditor.
9.    You will see that a chooser pops up showing MalActivity before ImageEditor.
# Steps to re-produce the exploit automatically
Coming soon.



