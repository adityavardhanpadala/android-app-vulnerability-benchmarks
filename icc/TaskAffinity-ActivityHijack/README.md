# Summary
Task Affinity allows malicious activities to hijack benign activities

# Android versions affected
Tested on Android 4.2 - Android 7.1

# Description of vulnerability and corresponding exploit
In *TaskAffinity-PhishingAttack* we explained how a malicious activity can poison a task comprised of benign activities. As a result of task poisoning,
malicious apps can rely on the *back button* to hijack benign activities.

*Issue:* If a user visits a malicious app's activity with the same task affinity as that of a benign app then the malicious activity becomes
part of the benign task. If this occurs then there will exist a benign activity A from which the user can navigate to a malicious activity M by
pressing the back button instead of navigating to the intended benign activity C. Therefore, malicious activity M will have hijacked benign
activity C.

*Example:* This issue is best illustrated by the pair of benign and malicious apps in TaskAffinity-ActivityHijack/Benign and TaskAffinity-ActivityHijack/Malicious. The Benign app is as follows:

1.    User navigates to LoginActivity when she starts the app. In this activity the user is asked to enter her credentials.
2.    If the credentials are authorized the user navigates to HomeActivity where she can take a picture.
3.    She can click on the picture to start the ImageEditor Activity where she can edit the image and send it back to HomeActivity.
      Note that the ImageEditor has a task affinity="edu.ksu.santos.benign.editImage" which means that ImageEditor is started/launched in a new task called "edu.ksu.santos.benign.editImage".

The Malicious app has also managed to install itself in the device. Let us assume that the malicious app provides some useful functionality. The malicious app is as follows:

1.    MalActivity which provides useful functionality to the user but hides the malicious behavior.

Let us assume that there exists a moment when the user navigates to *MalActivity*. Let us also say that after navigating to *MalActivity*, the user
navigates to our Benign app and navigates to *ImageEditor*. When the user presses the *back button* from *ImageEditor*, *MalActivity* displayes a
login screen similar to LoginActivity in *Benign*. The user enters her credentials and the credentails are compromised. *MalActivity* takes the user
back to *LoginActivity* making it look like the user's session was lost.

# Steps to re-produce the exploit with Android Studio
1.    Go to open an existing project in Android Studio and browse to TaskAffinity-ActivityHijack/Malicious
2.    If an emulator exists or a device is connected, launch Malicious in it.
3.    If an emulator or device is not available then go to Run->Run App and click on "Create New Virtual Device".
4.    Follow the instructions to create an emulator and launch Benign in it.
5.    Go to emulator/device
6.    Start Benign -> Login -> Click on Take Picture -> Click on the image displayed.
9.    Click back button.
11.   You will see a screen similar to LoginActivity pop up but with the title Malicious1.

# Steps to re-produce the exploit automatically
Coming soon.
