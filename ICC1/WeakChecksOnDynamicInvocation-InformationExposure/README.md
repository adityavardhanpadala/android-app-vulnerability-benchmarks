# Summary
A method in the Content Provider API exposes the underlying data store to unauthorized read and write.

# Versions of Android where the vulnerability is possible
Tested on Android 4.2 - Android 7.1

# Sample list of apps that exhibit the vulnerability
Yet to be explored.

# Description of the vulnerability and the corresponding exploit.
Android allows developers to share data across apps through the Content Provider API. Developers can limit access to their content
providers via permissions. Whenever a request for data read/write is made to a content provider method by a component, the android system checks to see if the component making the request has the required permissions to do so.

*Issue:* The Content provider API provides a method *call(String method, String args, Bundle extras)* to call any provider-defined method. The framework does
no permission checking on this entry into the content provider besides the basic ability for the application to get access to the provider at all.
For example, it has no idea whether the call being executed may read or write data in the provider, so can't enforce those individual permissions.
Any implementation of this method must do its own permission checks on incoming calls to make sure they are allowed.
Failure to do so will allow unauthorized components to interact with the content provider.

*Example:* The benign app in *WeakChecksOnDynamicInvoation-InformationExposure/app* helps a user manage her files. This app has a content provider that provides an
interface to its Database. The Database saves all files created, edited and uploaded by the user. The app also works
offline i.e. when the device is not connected to the internet, it saves the files locally in its internal storage and
uploads the files to the database when the device is connected to the internet. Unfortunately the interface to save files
to local internal storage is vulnerable i.e. the *FileProvider.java* uses the method *call()* to save files locally in internal storage
when the device is offline. A malicious app can invoke it and inject malicious files into the internal file-
system (see *WeakChecksOnDynamicInvoation-InformationExposure/Malicious/app/src/main/java/.../MainActivity.java*). When the device comes back online, the app data is sync-ed with the database.
Any malicious files in the internal file-system also gets uploaded. Since, the benign content provider allows other apps to read (but not write) from the database (see *WeakChecksOnDynamicInvoation-InformationExposure/app/src/main/AndroidManifest.xml*),
a malicious app can read the injected files from the database and execute it in its own context.

# Pre-requisites for build
Tested with Android Studio 2.3. Download [Android Studio](https://developer.android.com/studio/index.html)

# Steps to build the sample apps and re-produce the apps in Android Studio
1.	Open Android Studio
2.	Go to Open Existing Project
3. 	Browse to ../WeakChecksOnDynamicInvoation-InformationExposure
4.	Go to Run->Run app
5.	If devices is connected or emulator is running then app is launched.
6.	If device or emulator not connected then either connect a device or choose an existing emulator or click on "Create New Android Virtual Device".
7.	If you connected a dvice then app will be launched in the device. If you launched an existing emulator then app will be launched in the emulator. If you created a new virtual device then select it and launch the app in it.
8.	Go to File->Open Existing Project.
9.	Go to Run->Run app and launch the app in which you installed/launched WeakChecksOnDynamicInvoation-InformationExposure/app
10. Go to the device/emulator and click on "Inject File" button.
11. Go to the window that has WeakChecksOnDynamicInvoation-InformationExposure/app open and check the log by clicking on "Android Monitor" at the bottom of the screen. The log should have a message "Data Backed up!"
12. You can also verify if the file has been injected by running adb:
..*	$ <path-to-android-sdk>/platform-tools/adb shell run-as "edu.ksu.cs.santos.benign"
..*	$ ls files
..* You should be able to see a file called "Malicious.sh"

# Steps to build the sample apps and re-produce the exploit

1. list targets:

    $ android list targets

2. available Android Virtual Devices:

    $ android list avd

3.  create an emulator:

    $ android create avd -n <name> -t <target>

4.  start emulator:

    $ emulator -avd <avd_name>

5. build and install *Benign*:

    $ cd Benign

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk. Build will fail without this.

    $ ./gradlew installDebug

6.  build and install *Malicious*:

    $ cd Malicious

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk. Build will fail without this.

    $ ./gradlew installDebug

7.  Launch *Malicious* and click on "Inject File"

8.  You can verify if the file has been injected by running adb:

     $ <path-to-android-sdk>/platform-tools/adb shell run-as "edu.ksu.cs.santos.benign"

     $ ls files

    You should be able to see a file called "Malicious.sh"
